# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –¥–ª—è Kaspi Analytics Dashboard

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Supabase

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ** –Ω–∞ [supabase.com](https://supabase.com)
2. **–ù–∞–∂–º–∏—Ç–µ** "Start your project" / "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç"
3. **–í–æ–π–¥–∏—Ç–µ** —á–µ—Ä–µ–∑ GitHub (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç)
4. **–°–æ–∑–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
5. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç:**
   - **Name**: `kaspi-analytics` (–∏–ª–∏ –ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
   - **Database Password**: –ü—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ!)
   - **Region**: –í—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, Frankfurt –¥–ª—è –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞)
   - **Plan**: Free (–¥–ª—è –Ω–∞—á–∞–ª–∞)

‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è...

## –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ** –≤ —Ä–∞–∑–¥–µ–ª **Settings** (‚öôÔ∏è –≤ –ª–µ–≤–æ–º –º–µ–Ω—é)
2. **–í—ã–±–µ—Ä–∏—Ç–µ** **Database**
3. **–ù–∞–π–¥–∏—Ç–µ** —Ä–∞–∑–¥–µ–ª **Connection string**
4. **–í—ã–±–µ—Ä–∏—Ç–µ** —Ä–µ–∂–∏–º **URI** (–Ω–µ Session mode!)
5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ** —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–°—Ç—Ä–æ–∫–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
```
postgresql://postgres.xxxxxxxxxxxx:[YOUR-PASSWORD]@aws-0-eu-central-1.pooler.supabase.com:6543/postgres
```

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ó–∞–º–µ–Ω–∏—Ç–µ `[YOUR-PASSWORD]` –Ω–∞ –ø–∞—Ä–æ–ª—å –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞!

## –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```env
# Supabase Database
DATABASE_URL="postgresql://postgres.xxxxxxxxxxxx:–í–ê–®_–ü–ê–†–û–õ–¨@aws-0-eu-central-1.pooler.supabase.com:6543/postgres"

# NextAuth (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å)
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="kaspi-analytics-secret-change-in-production"

# Session Encryption (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å –∏–ª–∏ —Å–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
SESSION_ENCRYPTION_KEY="your-32-character-encryption-key-here-change-this"
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:

```bash
# –î–ª—è NEXTAUTH_SECRET (–≤ PowerShell)
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Maximum 256 }))

# –ò–ª–∏ –≤ Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

## –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π Prisma

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase:

```bash
npx prisma migrate dev --name initial_setup
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ `prisma/schema.prisma`
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Prisma Client

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úî Generated Prisma Client
‚úî Applied migration(s)
```

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Table Editor** –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
2. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
   - `User`
   - `Order`
   - `OrderEntry`
   - `Product`
   - `ProductAnalytics`
   - `FinancialMetrics`
   - `CompetitorPrice`
   - `PriceRule`
   - `PriceHistory`
   - `EmailNotification`
   - `SyncLog`

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Prisma Studio

```bash
npx prisma studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ `http://localhost:5555` –≥–¥–µ –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.

## –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Supabase! –í—ã –º–æ–∂–µ—Ç–µ:

1. **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è** –Ω–∞ `/register`
2. **–í—Ö–æ–¥–∏—Ç—å** –Ω–∞ `/login`
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥** –Ω–∞ `/dashboard`

## üìä –¢–∞–±–ª–∏—Ü—ã –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞–ª–∏—Å—å –≤ Supabase

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ–ª—è |
|---------|----------|------|
| **User** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã | email, password, kaspiConnected, kaspiMerchantId |
| **Order** | –ó–∞–∫–∞–∑—ã –∏–∑ Kaspi | kaspiOrderCode, totalPrice, customerName, state |
| **Product** | –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ | sku, name, price, availableAmount |
| **FinancialMetrics** | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ | date, totalRevenue, netProfit, commission |
| **PriceRule** | –ü—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è | productSku, minPrice, dumpingAmount, autoUpdate |
| **PriceHistory** | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω | productSku, oldPrice, newPrice, reason |

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Row Level Security (RLS)

Supabase –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É RLS, –Ω–æ –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Prisma —á–µ—Ä–µ–∑ backend API, –Ω–∞–º —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Policies**
2. –î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É
3. –ü—Ä–∏–º–µ—Ä –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è User:
```sql
CREATE POLICY "Users can only see their own data"
ON public."User"
FOR SELECT
USING (auth.uid() = id);
```

**–ù–û**: –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ NextAuth —É–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –ø–æ—ç—Ç–æ–º—É RLS –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í Supabase Dashboard –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **Database** ‚Üí **Database usage** - —Ä–∞–∑–º–µ—Ä –ë–î
2. **Database** ‚Üí **Query performance** - –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. **Logs** - –ª–æ–≥–∏ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üîÑ –ë—É–¥—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è/—Ç–∞–±–ª–∏—Ü—ã):

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç–µ prisma/schema.prisma
# 2. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev --name –Ω–∞–∑–≤–∞–Ω–∏–µ_–∏–∑–º–µ–Ω–µ–Ω–∏—è

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate deploy
```

## üö® Troubleshooting

### –û—à–∏–±–∫–∞: "Can't reach database server"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `DATABASE_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–º–µ–Ω–∏–ª–∏ `[YOUR-PASSWORD]` –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–∞—Ä–æ–ª—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–∞—Ä–æ–ª—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å - –∑–∞–∫–æ–¥–∏—Ä—É–π—Ç–µ –∏—Ö)

### –û—à–∏–±–∫–∞: "Invalid connection string"

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Transaction mode** –∏–ª–∏ **Session mode** —Å—Ç—Ä–æ–∫—É –∏–∑ Supabase
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `postgresql://`

### –û—à–∏–±–∫–∞: "Schema does not exist"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx prisma db push
```

### –ü–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã

–ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç `@`, `#`, `$` –∏ —Ç.–¥., –∑–∞–∫–æ–¥–∏—Ä—É–π—Ç–µ –µ–≥–æ:

```javascript
// –í Node.js
encodeURIComponent('–≤–∞—à-–ø–∞—Ä–æ–ª—å-—Å-—Å–∏–º–≤–æ–ª–∞–º–∏')
```

–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ `DATABASE_URL`.

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase –º–æ–∂–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
2. ‚úÖ –í–æ–π—Ç–∏ –≤ –¥–∞—à–±–æ—Ä–¥
3. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≠–¢–ê–ü 2: –¢–æ–≤–∞—Ä—ã –∏ –§–∏–Ω–∞–Ω—Å—ã
4. ‚è≥ –ü–æ–¥–∫–ª—é—á–∏—Ç—å Kaspi API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Supabase Documentation](https://supabase.com/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Connection Pooling](https://supabase.com/docs/guides/database/connecting-to-postgres#connection-pooler)

---

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue! üöÄ
