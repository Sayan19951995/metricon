# Database Schema

> Auto-generated by `npm run update-schema` — 2026-02-08T12:10:30.530Z

## daily_stats

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | YES |  |  | → stores.id |
| date | date | NO |  |  |  |
| revenue | numeric | YES | `0` |  |  |
| cost | numeric | YES | `0` |  |  |
| profit | numeric | YES | `0` |  |  |
| orders_count | int4 | YES | `0` |  |  |

## message_logs

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | YES |  |  | → stores.id |
| order_id | uuid | YES |  |  | → orders.id |
| phone | varchar | NO |  |  |  |
| message | text | NO |  |  |  |
| status | varchar | YES | `'pending'::character varying` |  |  |
| sent_at | timestamptz | YES |  |  |  |
| created_at | timestamptz | YES | `now()` |  |  |

## message_templates

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | YES |  |  | → stores.id |
| trigger_type | varchar | NO |  |  |  |
| name | varchar | NO |  |  |  |
| template_kz | text | YES |  |  |  |
| template_ru | text | YES |  |  |  |
| active | bool | YES | `true` |  |  |
| created_at | timestamptz | YES | `now()` |  |  |

## operational_expenses

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | YES |  |  | → stores.id |
| name | varchar | NO |  |  |  |
| amount | numeric | NO |  |  |  |
| start_date | date | NO |  |  |  |
| end_date | date | NO |  |  |  |
| created_at | timestamptz | YES | `now()` |  |  |

## orders

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | YES |  |  | → stores.id |
| kaspi_order_id | varchar | NO |  |  |  |
| customer_name | varchar | YES |  |  |  |
| customer_phone | varchar | YES |  |  |  |
| delivery_address | text | YES |  |  |  |
| delivery_date | date | YES |  |  |  |
| status | varchar | YES | `'new'::character varying` |  |  |
| total_amount | numeric | NO |  |  |  |
| items | jsonb | YES |  |  |  |
| created_at | timestamptz | YES | `now()` |  |  |
| completed_at | timestamptz | YES |  |  |  |
| delivery_mode | varchar | YES |  |  |  |
| delivery_cost | numeric | YES | `0` |  |  |

## pricelist_feeds

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | NO |  |  | → stores.id |
| feed_token | uuid | NO | `gen_random_uuid()` |  |  |
| auth_login | text | YES |  |  |  |
| auth_password | text | YES |  |  |  |
| preorder_overrides | jsonb | YES | `'{}'::jsonb` |  |  |
| cached_xml | text | YES |  |  |  |
| cached_at | timestamptz | YES |  |  |  |
| enabled | bool | YES | `true` |  |  |
| created_at | timestamptz | YES | `now()` |  |  |
| updated_at | timestamptz | YES | `now()` |  |  |

## products

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| store_id | uuid | YES |  |  | → stores.id |
| kaspi_id | varchar | YES |  |  |  |
| name | varchar | NO |  |  |  |
| sku | varchar | YES |  |  |  |
| price | numeric | YES | `0` |  |  |
| cost_price | numeric | YES |  |  |  |
| quantity | int4 | YES | `0` |  |  |
| image_url | text | YES |  |  |  |
| category | varchar | YES |  |  |  |
| active | bool | YES | `true` |  |  |
| created_at | timestamptz | YES | `now()` |  |  |

## stores

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| user_id | uuid | YES |  |  | → users.id |
| name | varchar | NO |  |  |  |
| kaspi_merchant_id | varchar | YES |  |  |  |
| whatsapp_connected | bool | YES | `false` |  |  |
| whatsapp_phone | varchar | YES |  |  |  |
| created_at | timestamptz | YES | `now()` |  |  |
| kaspi_api_key | text | YES |  |  |  |
| whatsapp_session | jsonb | YES |  |  |  |
| kaspi_session | jsonb | YES |  |  |  |
| marketing_session | jsonb | YES |  |  |  |
| commission_rate | numeric | YES | `12.5` |  |  |
| tax_rate | numeric | YES | `4.0` |  |  |

## subscriptions

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| user_id | uuid | YES |  |  | → users.id |
| plan | varchar | YES | `'start'::character varying` |  |  |
| status | varchar | YES | `'active'::character varying` |  |  |
| addons | _text | YES | `'{}'::text[]` |  |  |
| start_date | date | YES | `CURRENT_DATE` |  |  |
| end_date | date | YES |  |  |  |
| auto_renew | bool | YES | `true` |  |  |

## users

| Column | Type | Nullable | Default | PK | FK |
|--------|------|----------|---------|----|----|
| id | uuid | NO | `gen_random_uuid()` | YES |  |
| email | varchar | NO |  |  |  |
| name | varchar | NO |  |  |  |
| phone | varchar | YES |  |  |  |
| avatar_url | text | YES |  |  |  |
| created_at | timestamptz | YES | `now()` |  |  |

